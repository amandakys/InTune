{% extends "intune/music_score_wrapper.html" %}
{% load staticfiles %}

{% block imports %}
<script src="{% static 'lib/vextab-div.js' %}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.2.1/lodash.js"></script>
<script src="https://code.jquery.com/jquery-2.2.0.min.js"></script>


<script>
    // Load VexTab module.
    vextab = VexTabDiv;

    $(function() {
      VexTab = vextab.VexTab;
      Artist = vextab.Artist;
      Renderer = Vex.Flow.Renderer;

      Artist.DEBUG = true;
      VexTab.DEBUG = false;

      // Create VexFlow Renderer from canvas element with id #canvas-to-load
      renderer = new Renderer($('#canvas-to-load')[0], Renderer.Backends.CANVAS);

      // Initialize VexTab artist and parser.
      artist = new Artist(10, 10, 600, {scale: 0.8});
      vextab = new VexTab(artist);

      function render() {
        try {
          vextab.reset();
          artist.reset();
          vextab.parse($("#to-render").val());
          artist.render(renderer);
          $("#error").text("");
        } catch (e) {
          console.log(e);
          $("#error").html(e.message.replace(/[\n]/g, '<br/>'));
        }
      }

      $("#to-render").keyup(_.throttle(render, 250));
      render();
    });
</script>

{% endblock imports %}


<body>

{% block score %}

<h1>VexTab Playground</h1>

<div style="float:left;width:600px;">
<canvas id="canvas-to-load"></canvas>
<div id="error"></div>
</div>

<div style="float:left;">


<form method="post" action="">
    {% csrf_token %}

    <textarea rows="20" cols="160" name="data" maxlength="10000" width="100%"
    id="to-render">
{% if composition.data %}{{ composition.data }}
{% else %}{{ composition.get_default_string }}
{% endif %}
    </textarea>


    <br>
    <button type="submit" class="btn btn-light">Save</button>
</form>

</div>

{% endblock %}
</body>
