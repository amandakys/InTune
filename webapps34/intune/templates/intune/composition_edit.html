{% extends "intune/base_layer.html" %}
{% load staticfiles %}
{% load bootstrap3 %}

{% block imports %}
<meta charset="utf-8">
<link rel="stylesheet" type="text/css"
      href="{% static 'intune/composition_edit.css' %}">
<script src="{% static 'lib/vextab-div.js' %}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.2.1/lodash.js"></script>
<script src="https://code.jquery.com/jquery-2.2.0.min.js"></script>

<script>
var vt = VexTabDiv;
var VexTab = vt.VexTab;
var Artist = vt.Artist;
var Renderer = vt.Flow.Renderer;

var artist = new Artist(10, 10, 200, {scale: 1});
var vextab = new VexTab(artist);

function edit_bar(bar_id) {
    $("#edit_text").val($("#render_" + bar_id).val());
    $('label[for="edit_text"]').html("Bar " + (bar_id + 1));
}

function render(bar_id, from_edit) {
    try {
        vextab.reset();
        artist.reset();
        var renderer = new Renderer($('#canvas_bar_' + bar_id)[0], Renderer.Backends.CANVAS);
        var stave = "tabstave notation=true tablature = false";
        if (bar_id > 0) { stave += " clef=none"; }
        var source = from_edit ? '#edit_text' : ('#render_' + bar_id);
        vextab.parse(stave + "\nnotes " + $(source).val());
        artist.render(renderer);
        $("#error2").text("");
    } catch (e) {
        console.log(e);
        $("#error2").html(e.message.replace(/[\n]/g, "<br/>"));
    }
}
</script>

{% endblock imports %}

{% block content %}

<h1>{{ composition.title }}</h1>

    <div class="container row text-center">
        {% for bar in composition.get_bar_list %}
        <canvas id="canvas_bar_{{ forloop.counter0 }}" onclick="edit_bar({{ forloop.counter0 }})"></canvas>
        <input type="text" style="display: none;" id="render_{{ forloop.counter0 }}" value="{{bar}}" />
        <script>
        render({{ forloop.counter0 }}, false);
        </script>
        {% endfor %}
    </div>

    {# Left Editor Buttons #}
<div class="col-md-2 text-center">
    <div class="btn-group-vertical" role="group"
         aria-label="Left Editor Buttons">
        <button type="button" class="btn btn-default">Octave Change
        </button>
        <button type="button" class="btn btn-default">Select Multiple
        </button>
    </div>
</div>

{# Center Buttons #}
<div class="col-md-8">
    <div class="container-fluid text-center">
        <div class="btn-group" role="group"
             aria-label="Notation Selection">
            <button type="button" class="btn btn-default bravura">
                &#xE1D2;
            </button>
            {# Semibreve #}
            <button type="button" class="btn btn-default bravura">
                &#xE1D3;
            </button>
            {# Minim #}
            <button type="button" class="btn btn-default bravura">
                &#xE1D5;
            </button>
            {# Crotchet #}
            <button type="button" class="btn btn-default bravura">
                &#xE1D7;
            </button>
            {# Quaver #}
            <button type="button" class="btn btn-default bravura">
                &#xE1D9;
            </button>
            {# Semiquaver #}
            <button type="button" class="btn btn-default bravura">
                &#xE1E7;
            </button>
            {# Dotted Note #}
            <button type="button" class="btn btn-default bravura">
                &#xE4E5;
            </button>
            {# Rest #}
            <button type="button" class="btn btn-default bravura">
                &#xE260;
            </button>
            {# Flat #}
            <button type="button" class="btn btn-default bravura">
                &#xE264;
            </button>
            {# Double Flat #}
            <button type="button" class="btn btn-default bravura">
                &#xE261;
            </button>
            {# Natural #}
            <button type="button" class="btn btn-default bravura">
                &#xE262;
            </button>
            {# Sharp #}
            <button type="button" class="btn btn-default bravura">
                &#xE263;
            </button>
            {# Double Sharp #}
        </div>

        <br>
        <label for="edit_text"></label>
        <input type="text" id="edit_text" style="margin: .8em; font-size: 1.5em" width="200" maxlength="30" />
        <div id="error"></div>
    </div>

</div>

<div class="col-md-2 text-center">
    <div class="btn-group-vertical" role="group"
         aria-label="Right Editor Buttons">
        <button type="button" class="btn btn-default">UP</button>
        <button type="button" class="btn btn-default">LEFT</button>
        <button type="button" class="btn btn-default">RIGHT
        </button>
        <button type="button" class="btn btn-default">DOWN</button>
    </div>
</div>
    </div>

<div class="container row">
    <div class="col-md-4">
        <form method="post" action="">
            {% csrf_token %}
            <div class="edit_users">
                <h6>Add/Remove shared users: </h6>
                {{ form.users }}
            </div>
        </form>
    </div>

    <div class="col-md-8">
        <a href="{% url 'intune:index' %}" class="btn btn-light">Back</a>

        <button type="submit" class="btn btn-light">Save</button>
        <button class="btn btn-light" style="" onclick="window.print();return false;">
            Print sheets
        </button>
    </div>

</div>






    {# needed for autocomplete to work #}
    {{ form.media }}

{% endblock content %}

{% block footer %}
    <footer class="footer">
        <div class="container footer-text">
            *Placeholder*
        </div>
        <div class="container footer-text">
            *Placeholder*
        </div>
        <div class="container footer-text">
            Notifications
        </div>
    </footer>
{% endblock footer %}
